<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-gb">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Service Container - Gimli</title>
    <meta name="generator" content="Hugo 0.21-DEV" />

    
    <meta name="description" content="A web application framework written in GO">
    
    <link rel="canonical" href="https://nickbryan.github.io/gimli/docs/0.1/dependency-injection/service-container/">
    
    <meta name="author" content="Nick Bryan">
    

    <meta property="og:url" content="https://nickbryan.github.io/gimli/docs/0.1/dependency-injection/service-container/">
    <meta property="og:title" content="Gimli">
    
    <meta name="apple-mobile-web-app-title" content="Gimli">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://nickbryan.github.io/gimli/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://nickbryan.github.io/gimli/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://nickbryan.github.io/gimli/fonts/icon.eot');
        src: url('https://nickbryan.github.io/gimli/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://nickbryan.github.io/gimli/fonts/icon.woff')
               format('woff'),
             url('https://nickbryan.github.io/gimli/fonts/icon.ttf')
               format('truetype'),
             url('https://nickbryan.github.io/gimli/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://nickbryan.github.io/gimli/stylesheets/application.css">
    <link rel="stylesheet" href="https://nickbryan.github.io/gimli/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://nickbryan.github.io/gimli/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://nickbryan.github.io/gimli/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto&#43;Mono">
    <style>
      body, input {
        font-family: 'Roboto', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://nickbryan.github.io/gimli/javascripts/modernizr.js"></script>

    

  </head>
  <body class=" ">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Service Container
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/iamnickbryan" title="@iamnickbryan on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/nickbryan" title="@nickbryan on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/nickbryan/gimli" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>Gimli <span class="version">0.1.2</span></strong>
        
          <br>
          nickbryan/gimli
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/nickbryan/gimli/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/nickbryan/gimli/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Home" href="https://nickbryan.github.io/gimli/">
	
	Home
</a>



  
</li>



<li>
  
    <span class="section">Getting Started</span>
    <ul>
      
        
        



<a  title="Installation" href="https://nickbryan.github.io/gimli/docs/0.1/getting-started/installation/">
	
	Installation
</a>



      
        
        



<a  title="Project Structure" href="https://nickbryan.github.io/gimli/docs/0.1/getting-started/project-structure/">
	
	Project Structure
</a>



      
        
        



<a  title="Framework Overview" href="https://nickbryan.github.io/gimli/docs/0.1/getting-started/framework-overview/">
	
	Framework Overview
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Bootstrapping</span>
    <ul>
      
        
        



<a  title="Configuration" href="https://nickbryan.github.io/gimli/docs/0.1/bootstrapping/configuration/">
	
	Configuration
</a>



      
        
        



<a  title="Defining Routes" href="https://nickbryan.github.io/gimli/docs/0.1/bootstrapping/defining-routes/">
	
	Defining Routes
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Dependency Injection</span>
    <ul>
      
        
        



<a  title="Service Container" href="https://nickbryan.github.io/gimli/docs/0.1/dependency-injection/service-container/">
	
	Service Container
</a>



      
    </ul>
  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/iamnickbryan" target="_blank" title="@iamnickbryan on Twitter">
              @iamnickbryan on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/nickbryan" target="_blank" title="@nickbryan on GitHub">
              @nickbryan on GitHub
            </a>
          </li>
          

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Service Container </h1>

			

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#service-providers">Service Providers</a></li>
<li><a href="#binding">Binding</a></li>
<li><a href="#resolving">Resolving</a></li>
</ul>

<p><a class="anchor" id="introduction"></a></p>

<h2 id="introduction">Introduction</h2>

<p>Gimli provides a basic service container implementation trough the <code>di</code> package. The container does not aim to be &ldquo;magic&rdquo;
and is a simple way to manage object dependencies. You must first bind any values you wish to use in the container:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">package</span> main

<span style="color: #0000aa">import</span> . <span style="color: #aa5500">&quot;github.com/nickbryan/gimli/di&quot;</span>

<span style="color: #0000aa">func</span> main() {
        container := NewContainer()
        
        container.Bind(<span style="color: #aa5500">&quot;name&quot;</span>, <span style="color: #0000aa">func</span>(container Container) <span style="color: #0000aa">interface</span>{} {
                <span style="color: #0000aa">return</span> <span style="color: #aa5500">&quot;Nick&quot;</span>
        })
}
</pre></div>


<p>There a few different ways you can bind values in the container which will be covered in the next section. Once your
values are bound in the container you can access them as follows:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">package</span> main

<span style="color: #0000aa">import</span> . <span style="color: #aa5500">&quot;github.com/nickbryan/gimli/di&quot;</span>

<span style="color: #0000aa">func</span> main() {
        container := NewContainer()
        
        container.Bind(<span style="color: #aa5500">&quot;name&quot;</span>, <span style="color: #0000aa">func</span>(container Container) <span style="color: #0000aa">interface</span>{} {
                <span style="color: #0000aa">return</span> <span style="color: #aa5500">&quot;Nick&quot;</span>
        })
        
        <span style="color: #00aaaa">println</span>(container.MustResolve(<span style="color: #aa5500">&quot;name&quot;</span>)) <span style="color: #aaaaaa; font-style: italic">// Prints &quot;Nick&quot; or panics of &quot;name&quot; is not bound.</span>
}
</pre></div>
</p>

<p><a class="anchor" id="service-providers"></a></p>

<h2 id="service-providers">Service Providers</h2>

<p>Service providers aim to provide a centralised way of encapsulating and organising your application bootstrapping with
the container. A simple example of a service provider in action is the routing provider used by the <code>foundation</code> package:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">package</span> providers

<span style="color: #0000aa">import</span> (
	<span style="color: #aa5500">&quot;github.com/nickbryan/gimli/di&quot;</span>
	<span style="color: #aa5500">&quot;github.com/nickbryan/gimli/routing&quot;</span>
)

<span style="color: #aaaaaa; font-style: italic">// RoutingProvider sets the router in the container.</span>
<span style="color: #0000aa">type</span> RoutingProvider <span style="color: #0000aa">struct</span>{}

<span style="color: #aaaaaa; font-style: italic">// Register a new router in the container.</span>
<span style="color: #0000aa">func</span> (p *RoutingProvider) Register(container di.Container) {
	container.Bind(<span style="color: #aa5500">&quot;router&quot;</span>, <span style="color: #0000aa">func</span>(container di.Container) <span style="color: #0000aa">interface</span>{} {
		<span style="color: #0000aa">return</span> routing.NewRouter()
	})
}
</pre></div>
</p>

<p>The <code>foundation</code> package then registers this with the container as follows:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>container.Register(&amp;providers.RoutingProvider{})
</pre></div>
</p>

<p>If you have created your project from the supplied skeleton you can do all the registering of your applications service
providers in the <code>bootstrap/providers.go</code> file.</p>

<p><a class="anchor" id="binding"></a></p>

<h2 id="binding">Binding</h2>

<h3 id="bind">Bind</h3>

<p>The most common way to bind a service on the container is to use the <code>Bind</code> method. The first parameter should be a string
that represents the nature of the service; used to resolve the service later. The second parameter should be a closure that
takes the container as its only parameter and returns an instance of the service.
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>container.Bind(<span style="color: #aa5500">&quot;Notifier&quot;</span>, <span style="color: #0000aa">func</span>(container di.Container) <span style="color: #0000aa">interface</span>{} {
    <span style="color: #0000aa">return</span> &amp;Notifier{
        Mailer: container.MustResolve(<span style="color: #aa5500">&quot;EmailService&quot;</span>),
    }
})
</pre></div>

Receiving the container as an argument to the resolver allows us to build up complex structs that require other services
bound in the container.</p>

<p>When a service is bound in the container via bind, the same instance of the service will be returned on each resolution.</p>

<h3 id="instance">Instance</h3>

<p>You can add an existing object instance into the container via the <code>Instance</code> method. Once bound, resolving will always
return the same instance:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>notifier := NewNotifier()
container.Instance(<span style="color: #aa5500">&quot;Notifier&quot;</span>, notifier)
</pre></div>
</p>

<h3 id="factory">Factory</h3>

<p>As mentioned above, values are shared by default when bound to the container. Sometimes you may want a new instance of
an object on each resolution. This can be achieved with the <code>Factory</code> method:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>container.Factory(<span style="color: #aa5500">&quot;SessionStore&quot;</span>, <span style="color: #0000aa">func</span>(container di.Container) <span style="color: #0000aa">interface</span>{} {
        <span style="color: #0000aa">return</span> NewSessionStorage()
})
</pre></div>
</p>

<p><a class="anchor" id="resloving"></a></p>

<h2 id="resolving">Resolving</h2>

<h3 id="resolve">Resolve</h3>

<p>Once a value has been bound to the container you can retrieve it via the <code>Resolve</code> method. The requested value and <code>nil</code>
will be returned if the value exists in the container, otherwise <code>nil</code> and an <code>error</code> will be returned:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">package</span> yours

<span style="color: #0000aa">import</span> . <span style="color: #aa5500">&quot;github.com/nickbryan/gimli/di&quot;</span>

<span style="color: #0000aa">func</span> main() {
        container := NewContainer()
      
        container.Instance(<span style="color: #aa5500">&quot;TheMeaningOfLife&quot;</span>, <span style="color: #009999">42</span>)
  
        val, err := container.Resolve(<span style="color: #aa5500">&quot;TheMeaningOfLife&quot;</span>)
        <span style="color: #0000aa">if</span> err != <span style="color: #0000aa">nil</span> {
                <span style="color: #00aaaa">panic</span>(err)
        }
    
        <span style="color: #00aaaa">println</span>(<span style="color: #aa5500">&quot;The meaning of life is: &quot;</span> + val.(<span style="color: #00aaaa">string</span>))
}
</pre></div>
</p>

<h3 id="mustresolve">MustResolve</h3>

<p>There is a short hand way of resolving from the container using <code>MustResolve</code>. If the value does not exist, <code>MustResolve</code>
will <code>panic</code>. You can use this as follows:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">package</span> yours

<span style="color: #0000aa">import</span> . <span style="color: #aa5500">&quot;github.com/nickbryan/gimli/di&quot;</span>

<span style="color: #0000aa">func</span> main() {
        container := NewContainer()
      
        container.Instance(<span style="color: #aa5500">&quot;TheMeaningOfLife&quot;</span>, <span style="color: #009999">42</span>)
    
        <span style="color: #00aaaa">println</span>(<span style="color: #aa5500">&quot;The meaning of life is: &quot;</span> + container.MustResolve(<span style="color: #aa5500">&quot;TheMeaningOfLife&quot;</span>).(<span style="color: #00aaaa">string</span>))
}
</pre></div>
</p>

<p>Or you could catch the panic as follows:
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #0000aa">package</span> yours

<span style="color: #0000aa">import</span> . <span style="color: #aa5500">&quot;github.com/nickbryan/gimli/di&quot;</span>

<span style="color: #0000aa">func</span> main() {
        <span style="color: #0000aa">defer</span> <span style="color: #0000aa">func</span>() {
                <span style="color: #0000aa">if</span> r := <span style="color: #00aaaa">recover</span>(); r != <span style="color: #0000aa">nil</span> {
                    <span style="color: #00aaaa">println</span>(<span style="color: #aa5500">&quot;Recovered from panic&quot;</span>, r)
                }
        }()

        container := NewContainer()
        
        <span style="color: #00aaaa">println</span>(<span style="color: #aa5500">&quot;The meaning of life is: &quot;</span> + container.MustResolve(<span style="color: #aa5500">&quot;TheMeaningOfLife&quot;</span>).(<span style="color: #00aaaa">string</span>))
}
</pre></div>
</p>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://nickbryan.github.io/gimli/docs/0.1/bootstrapping/defining-routes/" title="Defining Routes">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Defining Routes
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
  </div>
</nav>


			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/nickbryan.github.io\/gimli\/';
      var repo_id  = 'nickbryan\/gimli';
    
    </script>

    <script src="https://nickbryan.github.io/gimli/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "Â¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

